webpackJsonp([7],{0:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,i){try{var o=t[a](i),s=o.value}catch(e){return void r(e)}return o.done?void e(s):Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function o(e){E.Push("site",!0)}function s(e,t){e.url&&e.url.includes("#")?v.browser.tabs.query({},function(r){return t(r.filter(function(t){return t.url==e.url&&t.active}))}):v.browser.tabs.query(e,function(e){t(e)})}function u(e,t){var r="";t==-1?S.Update("tempread"):(r="-enable",p.storage.option.menu.read===!0&&S.Create("read"),S.Update("read")),chrome.action.setIcon({tabId:e,path:chrome.runtime.getURL("assets/images/icon16"+r+".png")})}function l(e){e.eventCategory,e.eventAction,e.eventValue}function c(){v.browser.runtime.setUninstallURL(p.storage.option.uninstall?p.storage.service+"/uninstall":""),l({eventCategory:"install",eventAction:"install",eventValue:"uninstall"})}var d=function(){function e(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=(function(){var e=i(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={active:!0,lastFocusedWindow:!0},e.next=3,chrome.tabs.query(t);case 3:return r=e.sent,n=d(r,1),a=n[0],e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),r(205)),f=a(h),p=r(12),m=r(16),g=n(m),v=r(6),b=r(91),y=n(b),w=r(154),S=n(w),A=r(30),E=n(A),k=r(472),_=n(k),M=r(206),O=n(M),x=r(207),I=n(x),T=r(92),R=a(T),C=-1;p.storage.Read(function(){p.storage.puread=new R.default(p.storage.sites),f.default.Firstload()?(f.default.Version(y.version),v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#firstload?ver="+y.version)})):(!f.default.Count()&&p.storage.GetRemote("remote",function(e,t){t||(p.storage.pr.Addsites(e),p.storage.Writesite(p.storage.pr.sites,o))}),y.version!=p.storage.version&&p.storage.GetRemote("local",function(e,t){p.storage.pr.Addsites(e),p.storage.Writesite(p.storage.pr.sites,function(){y.version!=p.storage.version&&p.storage.Fix(p.storage.read.sites,p.storage.version,y.version,p.storage.focus.sites),y.version!=p.storage.version&&p.storage.Write(function(){f.default.Version(y.version),v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#update?ver="+y.version)})},y.Verify(p.storage.version,p.storage.simpread)),o(e)})}),y.version==p.storage.version&&y.patch!=p.storage.patch&&p.storage.Write(function(){f.default.Patch("add",!0)},y.FixSubver(y.patch,p.storage.simpread))),S.CreateAll(),setTimeout(function(){return c()},100)}),S.OnClicked(function(e,t){l({eventCategory:"menu",eventAction:"menu",eventValue:e.menuItemId}),"link"==e.menuItemId?e.linkUrl&&v.browser.tabs.create({url:e.linkUrl+"?simpread_mode=read"}):"list"==e.menuItemId?v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#later")}):"whitelist"==e.menuItemId?v.browser.tabs.sendMessage(t.id,g.Add(g.MESSAGE_ACTION.menu_whitelist,{url:e.pageUrl})):"exclusion"==e.menuItemId?v.browser.tabs.sendMessage(t.id,g.Add(g.MESSAGE_ACTION.menu_exclusion,{url:e.pageUrl})):"blacklist"==e.menuItemId?v.browser.tabs.sendMessage(t.id,g.Add(g.MESSAGE_ACTION.menu_blacklist,{url:e.pageUrl})):"unrdist"==e.menuItemId?v.browser.tabs.sendMessage(t.id,g.Add(g.MESSAGE_ACTION.menu_unrdist,{url:e.pageUrl})):"lazyload"==e.menuItemId?v.browser.tabs.sendMessage(t.id,g.Add(g.MESSAGE_ACTION.menu_lazyload,{url:e.pageUrl})):t.url.startsWith("chrome://")||v.browser.tabs.sendMessage(t.id,g.Add(e.menuItemId))}),v.browser.runtime.onMessage.addListener(function(e,t,r){return e.type==g.MESSAGE_ACTION.CORB&&$.ajax(e.value.settings).done(function(e){r({done:e})}).fail(function(e,t,n){r({fail:{jqXHR:e,textStatus:t,errorThrown:n}})}),!0}),v.browser.runtime.onMessage.addListener(function(e,t,r){if(e.type==g.MESSAGE_ACTION.jianguo){var n=e.value,a=n.url,i=n.user,o=n.password,s=n.method,u=new _.Fs(a,i,o);"folder"==s.type?u.dir(s.root).mkdir(function(e){u.dir(s.root+"/"+s.folder).mkdir(function(e){r({done:e,status:e.status})})}):"file"==s.type?u.file(s.path).write(s.content,function(e){r({done:e,status:e.status})}):"read"==s.type&&u.file(s.path).read(function(e){r({done:e.response,status:e.status})})}}),v.browser.runtime.onMessage.addListener(function(e,t,r){if(e.type==g.MESSAGE_ACTION.WebDAV){var n=e.value,a=n.url,i=n.user,o=n.password,s=n.method,u=new _.Fs(a,i,o);"folder"==s.type?u.dir(s.root).mkdir(function(e){r({done:e,status:e.status})}):"file"==s.type&&u.file(s.root+"/"+s.name).write(s.content,function(e){r({done:e,status:e.status})})}}),v.browser.runtime.onMessage.addListener(function(e,t,r){if(e.type==g.MESSAGE_ACTION.download){var n=e.value,a=n.data,i=n.name,o=new Blob([a],{type:"html/plain;charset=utf-8"}),s=URL.createObjectURL(o);v.browser.downloads.download({url:s,filename:i.replace(/[|]/gi,"")},function(e){r({done:e})})}else if(e.type==g.MESSAGE_ACTION.base64){var u=e.value.url;fetch(u).then(function(e){return e.blob()}).then(function(e){return new Promise(function(t,n){var a=new FileReader;a.onloadend=function(e){r({done:{url:u,uri:e.target.result}})},a.onerror=function(e){r({fail:{error:e,url:u}})},a.readAsDataURL(e)})}).catch(function(e){r({fail:{error:e,url:u}})})}else e.type==g.MESSAGE_ACTION.permission&&O.Get({permissions:["downloads"]},function(e){r({done:e})});return!0}),v.browser.runtime.onMessage.addListener(function(e,t,r){if(e.type==g.MESSAGE_ACTION.snapshot){var n=e.value,a=n.left,i=n.top,o=n.width,s=n.height;chrome.tabs.captureVisibleTab({format:"png"},function(e){var t=new Image;t.src=e,t.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d"),u=self.devicePixelRatio,l=a*u,c=i*u,d=o*u,h=s*u;e.width=d,e.height=h,n.drawImage(t,l,c,d,s*u,0,0,d,h);var f=e.toDataURL("image/png");r({done:f})}})}return!0}),v.browser.runtime.onMessage.addListener(function(e,t,r){switch(e.type){case g.MESSAGE_ACTION.shortcuts:s({url:e.value.url},function(e){v.browser.tabs.sendMessage(e[0].id,g.Add(g.MESSAGE_ACTION.shortcuts))});break;case g.MESSAGE_ACTION.browser_action:s({url:e.value.url},function(t){t&&t.length>0&&t[0].url==e.value.url&&u(t[0].id,e.value.code)});break;case g.MESSAGE_ACTION.new_tab:v.browser.tabs.create({url:e.value.url});break;case g.MESSAGE_ACTION.close_tab:s({active:!0},function(t){t.forEach(function(t){t.active&&t.url==e.value.url&&v.browser.tabs.remove(t.id)})});break;case g.MESSAGE_ACTION.menu:var n=e.value,a=n.id,i=n.value;p.storage.option.menu[a]=i,i===!0?S.Create(a):S.Remove(a);break;case g.MESSAGE_ACTION.updated:E.Push(e.value.type,e.value.value);break;case g.MESSAGE_ACTION.save_verify:r(E.Lock(e.value.url));break;case g.MESSAGE_ACTION.auth:v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#labs?auth="+e.value.name.toLowerCase())});break;case g.MESSAGE_ACTION.update_site:s({active:!0,url:e.value.url},function(t){t.length>0&&(C=t[0].id),v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#sites?update="+encodeURI(JSON.stringify(e.value.site)))})});break;case g.MESSAGE_ACTION.save_site:v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#sites?pending="+encodeURI(JSON.stringify(e.value)))});break;case g.MESSAGE_ACTION.temp_site:v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#sites?temp="+encodeURI(JSON.stringify(e.value)))});break;case g.MESSAGE_ACTION.auth_success:s({url:e.value.url},function(t){t&&t.length>0&&(v.browser.tabs.remove(t[0].id),s({active:!0},function(t){t.forEach(function(t){return v.browser.tabs.sendMessage(t.id,g.Add(g.MESSAGE_ACTION.export,{type:e.value.name.toLowerCase()}))})}))});break;case g.MESSAGE_ACTION.track:l(e.value);break;case g.MESSAGE_ACTION.speak:v.browser.tts.speak(e.value.content);break;case g.MESSAGE_ACTION.speak_stop:v.browser.tts.stop();break;case g.MESSAGE_ACTION.tips:I.Verify(e.value.code,r);break;case g.MESSAGE_ACTION.tips_norepeat:I.Done(e.value.code);break;case g.MESSAGE_ACTION.screenshot:N.status("orange","grab"),L.grab(e.value.exportType)}}),v.browser.tabs.onActivated.addListener(function(e){s({active:!0,currentWindow:!0},function(e){e&&e.length>0&&"complete"==e[0].status&&(e&&e.length>0&&!e[0].url.startsWith("chrome://")?v.browser.tabs.sendMessage(e[0].id,g.Add(g.MESSAGE_ACTION.tab_selected,{is_update:!1})):u(e[0].id,-1))})}),v.browser.tabs.onUpdated.addListener(function(e,t,r){if(E.Pull(e),"complete"==t.status){if(r.url.startsWith("http://ksria.com/simpread/auth.html")){var n=r.url.replace("http://ksria.com/simpread/auth.html?id=",""),a=n.includes("#")||n.includes("&")?n.substr(0,n.search(/\S(#|&)/)+1):n;v.browser.tabs.query({},function(t){var n=t.find(function(e){return e.url.includes(chrome.runtime.getURL("options/options.html"))});n&&(v.browser.tabs.sendMessage(n.id,g.Add(g.MESSAGE_ACTION.redirect_uri,{uri:r.url,id:a})),v.browser.tabs.remove(e))})}else if(r.url.startsWith("https://simpread.ksria.cn/plugins/install/")){var i=r.url.replace("https://simpread.ksria.cn/plugins/install/","");v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#plugins?install="+encodeURIComponent(i))}),v.browser.tabs.remove(e)}else if(r.url.startsWith("https://simpread.ksria.cn/sites/install/")){var o=r.url.replace("https://simpread.ksria.cn/sites/install/","");v.browser.tabs.create({url:chrome.runtime.getURL("options/options.html#sites?install="+encodeURIComponent(o))}),v.browser.tabs.remove(e)}else r.url==v.browser.runtime.getURL("options/options.html#sites?update=success")?(v.browser.tabs.remove(e),C>0&&chrome.tabs.reload(C,function(){})):r.url==v.browser.runtime.getURL("options/options.html#sites?update=failed")?v.browser.tabs.remove(e):r.url==v.browser.runtime.getURL("options/options.html#sites?update=complete")?v.browser.tabs.remove(e):r.url==v.browser.runtime.getURL("options/options.html#sites?update=pending")&&(v.browser.tabs.remove(e),C>0&&v.browser.tabs.sendMessage(C,g.Add(g.MESSAGE_ACTION.pending_site)));r.url.startsWith("chrome://")?u(r.id,-1):v.browser.tabs.sendMessage(e,g.Add(g.MESSAGE_ACTION.tab_selected,{is_update:!0}))}}),v.browser.tabs.onRemoved.addListener(function(e){return E.Pull(e)}),chrome.action.onClicked.addListener(function(e){v.browser.tabs.sendMessage(e.id,g.Add(g.MESSAGE_ACTION.browser_click))}),chrome.runtime.onInstalled.addListener(function(e){var t=e.reason,r=e.previousVersion;"install"===t?chrome.tabs.create({url:"https://ladderreader.com",active:!0}):"update"===t&&!hasNewVersion(r)});var N={status:function(e,t,r){null!=e&&("green"==e?chrome.action.setBadgeBackgroundColor({color:[0,255,0,255]}):"red"==e?chrome.action.setBadgeBackgroundColor({color:[255,0,0,255]}):"orange"==e?chrome.action.setBadgeBackgroundColor({color:[255,128,0,255]}):"azure"==e&&chrome.action.setBadgeBackgroundColor({color:[0,128,255,255]}),chrome.action.setBadgeText({text:t}),r>0&&setTimeout(function(){chrome.action.setBadgeText({text:""})},r))}},L={imageDataURL:[],shared:{imageDirtyCutAt:0,imageDataURL:0,originalScrollTop:0,tab:{id:0,url:"",title:"",hasVscrollbar:!1}},grab:function(){function e(e){return t.apply(this,arguments)}var t=i(regeneratorRuntime.mark(function e(t){var r,n,a,i,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,this.imageDataURLPartial=[],n={active:!0,lastFocusedWindow:!0},e.next=5,chrome.tabs.query(n);case 5:if(a=e.sent,i=d(a,1),o=i[0],r.shared.tab=o,s=o.url.match(/https?:\/\/chrome.google.com\/?.*/),null===s){e.next=13;break}return alert("I'm sorry.\n\nDue to security restrictions \non the Google Chrome Store, \nBlipshot can't run here.\n\nTry on any other page. ;)\n\n"),e.abrupt("return",!1);case 13:chrome.tabs.sendMessage(r.shared.tab.id,{action:"heartbeat"},function(e){e||N.status("red","!",1e3)}),r.shared.exportType=t,chrome.tabs.sendMessage(r.shared.tab.id,{action:"blanketStyleSet",type:"blanketStyleSet",property:"position",from:"fixed",to:"absolute"}),chrome.tabs.sendMessage(r.shared.tab.id,{action:"blanketStyleSet",type:"blanketStyleSet",property:"position",from:"sticky",to:"relative"}),r.screenshotBegin(r.shared);case 18:case"end":return e.stop()}},e,this)}));return e}(),screenshotBegin:function(e){chrome.tabs.sendMessage(this.shared.tab.id,{action:"screenshotBegin",type:"screenshotBegin",shared:e})},screenshotVisibleArea:function(e){var t=this;chrome.tabs.captureVisibleTab(null,{format:"png",quality:100},function(r){return r?(t.imageDataURLPartial.push(r),void t.screenshotScroll(e)):(alert("I'm sorry.\n\nIt seems Blipshot wasn't able to grab the screenshot of the active tab.\n\nPlease check the extension permissions.\n\nIf the problem persists contact me at \nhttp://github.com/folletto/Blipshot/issues\n\nError: "+chrome.runtime.lastError.message+"\n\n"),!1)})},screenshotScroll:function(e){chrome.tabs.sendMessage(this.shared.tab.id,{action:"screenshotScroll",type:"screenshotScroll",shared:e})},screenshotEnd:function(e){N.status("azure","make"),chrome.tabs.sendMessage(this.shared.tab.id,{action:"handleRecursiveImageMerge",type:"handleRecursiveImageMerge",shared:e,imageDataURLPartial:this.imageDataURLPartial})},screenshotReturn:function(e){N.status("green","✓",3e3),chrome.tabs.sendMessage(this.shared.tab.id,{action:"blanketStyleRestore",type:"blanketStyleRestore",property:"position"}),chrome.tabs.sendMessage(this.shared.tab.id,{action:"screenshotReturn",type:"screenshotReturn",shared:e})},eventManagerInit:function(){var e=this;v.browser.runtime.onMessage.addListener(function(t){switch(t.action){case"grab":e.grab();break;case"screenshotVisibleArea":e.screenshotVisibleArea(t.shared);break;case"screenshotEnd":e.screenshotEnd(t.shared);break;case"screenshotReturn":e.screenshotReturn(t.shared)}})},recursiveImageMerge:function(e){function t(t,r,n,a,i,o){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,r,n,a,i){i=i||0,a=a||[],i<e.length&&(a[i]=new Image,a[i].onload=function(){if(e[i]=null,i==e.length-1){var o=window.document.createElement("canvas");o.width=a[0].width-(r?15:0),a.length>1?o.height=(e.length-1)*a[0].height+t:o.height=a[0].height,o.height>32766&&(o.height=32766);for(var s=0;s<a.length;s++){var u=0;a.length>1&&s==a.length-1&&(u=a[s].height-t);var l=a[s].height-u,c=a[s].width;o.getContext("2d").drawImage(a[s],0,u,c,l,0,s*a[0].height,c,l)}n(o.toDataURL("image/png"))}else recursiveImageMerge(e,t,r,n,a,++i)},a[i].src=e[i])})};L.eventManagerInit()},92:function(e,t,r){var n,a,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o,s){"object"==i(t)&&"undefined"!=typeof e?e.exports=s():(n=s,a="function"==typeof n?n.call(t,r,t,e):n,!(void 0!==a&&(e.exports=a)))}(void 0,function(){"use strict";function e(e){return $.extend(!0,{},e)}function t(e){if(document){var t=document.createElement("a");return t.href=e,t}var r=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)([\/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/);return r&&{href:e,protocol:r[1],host:r[2],hostname:r[3],port:r[4],pathname:r[5],search:r[6],hash:r[7]}}function r(e){if(""==e)return[0,e];if(a(e))return[2,e];var t=e.match(/<\S+ (class|id)=("|')?[\w-_=;:' ]+("|')?>?$|<[^/][-_a-zA-Z0-9]+>?$/gi);return t&&t.length>0?[1,t]:[-1,void 0]}function n(e){var t=r(e),n=S(t,2),a=n[0],i=n[1];if(2==a)return e;if(1==a){var o=i[0].trim().replace(/['"<>]/g,"").replace(/ /gi,"=").split("="),s=S(o,3),u=s[0],l=s[1],c=s[2];return l?"class"===l.toLowerCase()?l=u+"."+c:"id"===l.toLowerCase()&&(l=u+"#"+c):l=u,l}return null}function a(e){return/^(\[\[)[\[{`'/]{1}[ \S]+[}`'/\]]\]\]{1}($)/g.test(e)}function o(e){var t=[e.replace(/(^)\[\[|\]\]$/g,"")],r=t[0],n=t[1];switch(r[0]){case"{":r=r.replace(/^{|}$/g,""),e=new Function("return "+r)(),n=0;break;case"'":e=(e=r.replace(/^'|'$/g,"")).match(/^<[a-zA-Z0-9_-]+>/g).join("").replace(/<|>/g,"")+":contains("+e.replace(/<[/a-zA-Z0-9_-]+>/g,"")+")",n=1;break;case"/":e=r.replace(/^\/|\/$/g,"").replace(/\\{2}/g,"\\").replace(/'/g,'"'),n=2;break;case"[":r=r.replace(/^{|}$/g,""),e=new Function("return "+r)()[0],n=3;break;case"`":r=u(r=r.replace(/^`|`$/g,"")),e=$(r),n=4;break;default:n=-1}return[e,n]}function s(e){try{if(""!=e.id)return void 0==e.id?"":"//*[@id='"+e.id+"']";if(e===document.body)return"/html[1]/"+e.tagName.toLowerCase();for(var t=0,r=e.parentNode.childNodes,n=0;n<r.length;n++){var a=r[n];if(a===e)return s(e.parentNode)+"/"+e.tagName.toLowerCase()+"["+(t+1)+"]";1===a.nodeType&&a.tagName===e.tagName&&t++}}catch(e){return""}}function u(e){return document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}function l(){var e=$("body"),t=!0,r=!1,n=void 0;try{for(var a,i=["[itemprop='articleBody']","article",".post-content",".entry-content",".post-article",".content-post",".article-entry",".article-content",".article-body",".markdown-body",".post",".content"][Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,s=e.find(o);if(s.length>0)return s}}catch(e){r=!0,n=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw n}}return-1}function c(){var e=document.location,t=(e.href,e.host,e.protocol,e.host,e.protocol.substr(0,e.protocol.indexOf(":")),e.protocol,e.host,e.pathname.substr(0,e.pathname.lastIndexOf("/")+1),new _.Readability(document.cloneNode(!0)).parse());return t}function d(r,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=function(e){var t=e.replace("www.","").match(/\.\S+\.\S+/g);return t?t[0].substr(1):e.replace("www.","")},s=t(O),u=[].concat(A(n.keys())),l=a.match(/[.a-zA-z0-9-_]+/g)[1].replace("www.",""),c=o(s.hostname),d=function(){return"/"==s.pathname||/\/(default|index|portal).[0-9a-zA-Z]+$/.test(s.pathname)},h=!0,f=!1,p=void 0;try{for(var m,g=u[Symbol.iterator]();!(h=(m=g.next()).done);h=!0){var v=m.value,b=n.get(v).name,y=o(b);v.startsWith("[[/")&&v.endsWith("/]]")&&new RegExp(v.replace(/^\[\[\/|\/\]\]/g,"")).test(location.href)?i.push([v,e(n.get(v)),r]):d()||v.endsWith("*")||v.replace(/^http[s]?:/,"")!=a.replace(/^http[s]?:/,"")?v.match(/\*/g)&&1==v.match(/\*/g).length&&!d()&&v.endsWith("*")&&l.includes(y)&&c==y&&a.includes(b)?i.push([v,e(n.get(v)),r]):k(s.origin+s.pathname,v)&&i.push([v,e(n.get(v)),r]):i.push([v,e(n.get(v)),r])}}catch(e){f=!0,p=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}}function h(e){if(!e.name||!e.url||!e.include)return-1;if(-1==r(e.title)[0]||-1==r(e.include)[0]||-1==r(e.desc)[0])return-2;if(e.paging){if(2!=e.paging.length)return-3;if(!e.paging[0].prev)return-4;if(!e.paging[1].next)return-5;if(-1==r(e.paging[0].prev)[0]||-1==r(e.paging[1].next)[0])return-6}if(e.avatar){if(2!=e.avatar.length)return-7;if(!e.avatar[0].name)return-8;if(!e.avatar[1].url)return-9;if(-1==r(e.avatar[0].name)[0]||-1==r(e.avatar[1].url)[0])return-10}return 0}function f(e){var t=e.replace('<div id="readability-page-1" class="page">',""),r=$(t)[0],n=r.outerHTML.replace(r.innerHTML,""),a=$(n)[0],i=a.tagName.toLowerCase(),o=a.className;return{id:a.id,cls:o,tag:i}}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",r=$("html");if(a(e)){var n=o(e),i=S(n,2),s=i[0],u=i[1];0==u?e=s:3==u?e=m(r.find(s)):4==u&&(e=s.html())}else"html"==t?e=m(r.find(e)):"multi"==t||(e=r.find(e).text().trim());return e}function m(e){var t="";switch(e.length){case 0:t="<sr-rd-content-error></sr-rd-content-error>";break;case 1:t=e.html().trim();break;default:t=e.map(function(e,t){return $(t).html()}).get().join("<br>")}return t}var g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},y=function e(t,r,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,r);if(void 0===a){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(n):void 0},w=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=("undefined"==typeof t?"undefined":i(t))&&"function"!=typeof t?e:t},S=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),A=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},E={url:"",target:"",matching:[],name:"",title:"",desc:"",exclude:[],include:"",avatar:[],paging:[]},k=void 0,_=void 0,M=void 0,O=void 0,x=function(){function r(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{global:[],custom:[],local:[]};g(this,r),this.url=(t=(e="/"!=(e=window.location.pathname)&&e.endsWith("/")?e=e.replace(/\/$/,""):e).replace(/\/[%@#.~a-zA-Z0-9_-]+$|^\/$/g,""),window.location.protocol+"//"+window.location.hostname+t+"/"),this.sites=n,this.current={},this.state="none",this.origins=[],this.mathjax=void 0,O=location.href}return v(r,[{key:"SetURL",value:function(e){var r,n=t(e),a=(r="/"!=(r=n.pathname)&&r.endsWith("/")?r=r.replace(/\/$/,""):r).replace(/\/[%@#.~a-zA-Z0-9_-]+$|^\/$/g,"");this.url=n.protocol+"//"+n.hostname+a+"/",O=e}},{key:"SetMinimatch",value:function(e){k=e}},{key:"SetRdability",value:function(e){_=e}},{key:"SetMarkdown",value:function(e){M=e}},{key:"isMathJax",value:function(){var e=this;return void 0==this.mathjax&&(this.mathjax=!1,$("body").find("script").each(function(t,r){r.type.startsWith("math")&&(e.mathjax=!0)})),this.mathjax}},{key:"MathJaxMode",value:function(){var e=l();if(-1!=e)return this.Newsite("read",e[0].outerHTML),this.dom=e[0],this.state="temp",e;var t=c();if(t&&""!=t.content){var r=f(t.content),n=r.id,a=r.cls,i=r.tag;return""!=n?"<"+i+' id="'+n+'">':""!=a?"<"+i+' class="'+a+'">':void 0}}},{key:"Readability",value:function(){try{var t=c();if(!t||""==t.content)throw"Readability error";this.Newsite("read",t.content,t.excerpt);var r=f(t.wrap),n=r.id,a=r.cls,i=r.tag;this.dom=""!=n?$("body").find("#"+n)[0]:""!=a?$("body").find("."+a.replace(/ /gi,"."))[0]:$("body").find(""+i)[0],this.state="temp"}catch(t){var o=l();-1!=o?(this.Newsite("read",o[0].outerHTML),this.dom=o[0],this.state="temp"):this.current.site=e(E)}}},{key:"Getsite",value:function(e,t){return this.sites[e].find(function(e){return e[0]==t})}},{key:"Getsites",value:function(){var e=this,t=[],r=function(){if(k(location.href,"file://**/*.txt")||k(location.href,"http*://**/*.txt"))return function(){var e=location.pathname.split("/").pop(),t="file:"==location.protocol?"local":"remote",r={name:"txtread::"+t,title:"<title>",desc:"",include:"<pre>",auto:!1,exclude:[]};return"remote"==t&&(r.include="",r.html=$("body pre").html().replace(/\n/gi,"<br>")),!$("title").html()&&$("head").append("<title>"+decodeURI(e.replace(".txt",""))+"</title>"),r}();if($($("body").children()[0]).is("pre")&&(k(location.href,"file://**/*.md")||k(location.href,"http*://**/*.md")))return function(){var e=location.pathname.split("/").pop(),t={name:"txtread::"+("file:"==location.protocol?"local":"remote"),title:"<title>",desc:"",include:"",auto:!1,exclude:[]},r=(new M.default.Converter).makeHtml($("body pre").text());return t.html=r,!$("title").html()&&$("head").append("<title>"+decodeURI(e.replace(".md",""))+"</title>"),t}();var e=/<\S+ (class|id)=("|')?[\w-_=;:' ]+("|')?>?$|<[^/][-_a-zA-Z0-9]+>?$/gi,t={name:$("meta[name='simpread:name']").attr("content"),url:$("meta[name='simpread:url']").attr("content"),title:$("meta[name='simpread:title']").attr("content"),desc:$("meta[name='simpread:desc']").attr("content"),include:$("meta[name='simpread:include']").attr("content"),exp:$("meta[name='simpread:exclude']").attr("content"),auto:$("meta[name='simpread:auto']").attr("content"),exclude:[]};if(t.name&&t.include){if(t.url&&!k(location.href,t.url))return;!t.title&&(t.title="<title>"),!t.desc&&(t.desc=""),!t.exp&&(t.exp=""),t.name="metaread::"+t.name,t.auto="true"==t.auto;var r=["title","desc","include","exp"].findIndex(function(r){return""!=t[r]&&!t[r].match(e)});return t.exclude.push(t.exp),delete t.exp,-1==r?t:void 0}}();if(this.current.url=this.url,r)this.current.auto=r.auto,this.current.url=r.url,delete r.auto,delete r.url,this.current.site=b({},r),this.current.site.name.startsWith("metaread::")&&(this.state="meta"),this.current.site.name.startsWith("txtread::")&&(this.state="txt");else if(d("local",new Map(this.sites.local),this.url,t),d("global",new Map(this.sites.global),this.url,t),d("person",new Map(this.sites.person),this.url,t),d("custom",new Map(this.sites.custom),this.url,t),t.length>0){var n=void 0;if(t.forEach(function(t){t[1].active&&(n=t,e.current.url=n[0],e.current.site=e.Safesite(b({},n[1]),n[2],n[0]),e.state="adapter")}),!n){var a=t[0];a[1].active=!0,this.current.url=a[0],this.current.site=this.Safesite(b({},a[1]),a[2],a[0]),this.state="adapter"}}else{var i=function(){if(location.pathname.includes("thread")||location.pathname.includes("forum.php")){if($(".t_f").length>0&&$(".favatar").find(".authi").length>0&&$(".avatar").find("img").length>0)return{avatar:[{name:"[[{$('.favatar').find('.authi')}]]"},{url:"[[{$('.avatar').find('img')}]]"}],include:"[[{$('.t_f')}]]"}}else if(/\/t\/[\w-]+\/\d+/.test(location.pathname)&&$("meta[name=generator]").attr("content").includes("discourse"))return{avatar:[{name:"[[{$('.topic-avatar').find('.a[data-user-card]')}]]"},{url:"[[{$('.topic-avatar').find('img')}]]"}],include:"[[{$('.cooked')}]]"};return-1}();-1!=i?(this.Newmultisite("read",i),this.state="temp"):this.Readability()}this.current.site.matching=t}},{key:"Addsites",value:function(e){var t=0;if(0==this.sites.global.length)this.sites.global=this.Formatsites(e),t=this.sites.global.length;else{var r=function(e,t){var r=new Map(t),n=[].concat(A(r.keys())),a=0;return e.map(function(e){n.includes(e[0])?n.includes(e[0]):a++}),{count:a,newsites:e}}(this.Formatsites(e),this.sites.global);t=r.count,this.sites.global=r.newsites}return t}},{key:"Addlocalsites",value:function(e){return this.sites.local=[].concat(A(e)),this.sites.local}},{key:"Addallsites",value:function(e){return this.sites={global:[].concat(A(e.global)),person:[].concat(A(e.person)),custom:[].concat(A(e.custom)),local:[].concat(A(e.local))},this.sites}},{key:"Newsite",value:function(e,t,r){var n={mode:e,url:window.location.href,site:{name:"tempread::"+window.location.host,title:"<title>",desc:"[[{$('meta[name=Description]').attr('content')||$('meta[name=description]').attr('content')}]]",include:"",exclude:[]}};t&&(n.site.html=t),this.current.mode=n.mode,this.current.url=n.url,this.current.site=this.Safesite(b({},n.site),"local",n.url),r&&(this.current.site.excerpt=r)}},{key:"Newmultisite",value:function(e,t){var r={mode:e,url:window.location.href,site:{name:"tempread::"+window.location.host,title:"<title>",desc:"",include:t.include,exclude:[],avatar:t.avatar}};this.current.mode=r.mode,this.current.url=r.url,this.current.site=this.Safesite(b({},r.site),"local",r.url)}},{key:"Updatesite",value:function(e,t,r){var n=this.sites[e].findIndex(function(e){return e[0]==t});-1==n&&(n=this.sites[e].length),this.sites[e].splice(n,1,r)}},{key:"Deletesite",value:function(e,t,r){var n=this.sites[e].findIndex(function(e){return e[0]==t});-1!=n&&this.sites[e].splice(n,1),r(n)}},{key:"Safesite",value:function(e,t,r){return e.url=r,e.target=t,""==e.name&&(e.name="tempread::"),(!e.avatar||0==e.avatar.length)&&(e.avatar=[{name:""},{url:""}]),(!e.paging||0==e.paging.length)&&(e.paging=[{prev:""},{next:""}]),e}},{key:"Cleansite",value:function(e){return delete e.url,delete e.html,delete e.target,delete e.matching,e.avatar&&e.avatar.length>0&&""==e.avatar[0].name&&delete e.avatar,e.paging&&e.paging.length>0&&""==e.paging[0].prev&&delete e.paging,e}},{key:"Formatsites",value:function(e){var t=new Map,r=!0,n=!1,a=void 0;try{for(var i,o=e.sites[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var s=i.value;if(0==h(s)){var u=s.url;delete s.url,t.set(u,s)}}}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return[].concat(A(t))}},{key:"Clearsites",value:function(e){e?this.sites[e]=[]:this.sites={global:[],custom:[],local:[]}}},{key:"Origins",value:function(e){var t=e.origins.map(function(e){return e.url});return(t=new Set(this.origins.concat(t))).forEach(function(e){""!=e.trim()&&e.trim().startsWith("http")&&e.trim().endsWith(".json")||t.delete(e)}),this.origins=[].concat(A(t)),this.origins}},{key:"Addorigins",value:function(e){return this.sites.custom=[].concat(A(e)),this.sites.custom}},{key:"Clearorigins",value:function(){var e=this.sites.custom.length;return this.sites.custom=[],e}}]),r}();return function(t){function r(e){g(this,r);var t=w(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.version="0.0.4 build 0111",t.org_url=location.href,t.html={},t.plugin={},t.pure=!1,t.cleanup=!1,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":i(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,x),v(r,[{key:"Exist",value:function(){return this.org_url==location.href}},{key:"AddPlugin",value:function(e){this.plugin={minimatch:e.minimatch,pangu:e.pangu,beautify:e.beautify,stylesheet:e.style,rdability:e.rdability,markdown:e.markdown},y(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"SetMinimatch",this).call(this,this.plugin.minimatch),y(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"SetRdability",this).call(this,this.plugin.rdability),y(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"SetMarkdown",this).call(this,this.plugin.markdown)}},{key:"ReadMode",value:function(){var t,r,a,i,o;this.html=(t=this.current.site,r=e(t),a=n(""==t.title?"<title>":t.title),i=n(t.desc),o=n(t.include),r.title=""==t.title||"<title>"==t.title?$("head title").text():p(a),r.desc=function(e){if(void 0==e)return e;var t=e.length,r=e.indexOf("。")+1;return t>100&&(e=r>0?e.substr(0,r):e.substr(0,101)+"......"),e}(t.excerpt?t.excerpt:p(i)),r.include=""==t.include&&""!=t.html?t.html:p(o,"html"),r.avatar&&r.avatar.length>0&&""==r.avatar[0].name&&delete r.avatar,r.paging&&r.paging.length>0&&""==r.paging[0].prev&&delete r.paging,r.avatar&&r.avatar.forEach(function(e){var t=Object.keys(e).join(),r=e[t];e[t]=p(n(r),"html")}),r.paging&&r.paging.forEach(function(e){var t=Object.keys(e).join(),r=e[t];e[t]=p(n(r))}),r)}},{key:"TempMode",value:function(e,t){this.state="temp",this.dom=t,this.Newsite(e,t.outerHTML)}},{key:"GetDom",value:function(e,t){return p(n(e),t)}},{key:"Include",value:function(){var e=this.current.site.include,t=[],r=n(e);try{if(a(r)){var i=o(e),s=S(i,2),u=s[0],l=s[1];
0==l?(e=e.replace(/\[\[{\$\(|}\]\]|\).html\(\)/g,""),t=$(o("[[["+e+"]]]")[0])):3==l&&(t=u)}else r&&(t=$("body").find(r))}catch(e){}return t}},{key:"Exclude",value:function(e){return function(e,t){var r=[],i="",s=!0,u=!1,l=void 0;try{for(var c,d=t[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;if(a(h)){var f=o(h),p=S(f,2),m=p[0],g=p[1];if(1==g)i=m;else if(2==g){var v=e.html().match(new RegExp(m,"g"));if(v&&v.length>0){var b=v.join("");i="*["+b+"]"}else i=void 0}else 3==g?m.remove():4==g&&m.remove()}else i=n(h);i&&r.push(i)}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}return r.join(",")}(e,this.current.site.exclude)}},{key:"Beautify",value:function(e){0!=e.children().length&&this.plugin.beautify&&(this.plugin.beautify.before(this.current.site.name,e),this.cleanup&&this.plugin.beautify.cleanHTML(e,this.pure,this.isMathJax()),this.plugin.beautify.specbeautify(this.current.site.name,e),this.plugin.beautify.removeSpareTag(this.current.site.name,e),this.plugin.beautify.htmlbeautify(e),this.plugin.beautify.commbeautify(this.current.site.name,e))}},{key:"Format",value:function(e){this.plugin.pangu&&this.plugin.pangu.spacingElementByClassName(e)}},{key:"Utils",value:function(){return{dom2Xpath:s,xPath2Dom:u}}}]),r}()})},205:function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){return localStorage[s+"-"+e]}function a(e,t){localStorage[s+"-"+e]=t}function i(e){localStorage.removeItem(s+"-"+e)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s="simpread",u={VER:"version",COUNT:"count",FIRST:"firstload",PATCH:"patch-update"},l=5,c=void 0,d=function(){function e(){r(this,e)}return o(e,[{key:"Count",value:function(){var e=[n(u.COUNT)],t=e[0],r=void 0===t?0:t;return c=r,a(u.COUNT,++c),!(c>l&&(a(u.COUNT,0),1))}},{key:"Firstload",value:function(){var e=[n(u.FIRST)],t=e[0],r=void 0===t?"true":t;return"true"==r&&(a(u.FIRST,!1),!0)}},{key:"Version",value:function(e){a(u.VER,e)}},{key:"Patch",value:function(e,t){if("add"==e)a(u.PATCH,t);else{if("get"==e)return n(u.PATCH);"remove"==e&&i(u.PATCH)}}},{key:"curcount",get:function(){return c}}]),e}(),h=new d;t.default=h},206:function(e,t,r){"use strict";function n(e,t){i.browser.permissions.contains({permissions:e.permissions},function(r){0==r?chrome.permissions.request(e,function(e){t(e)}):t(r)})}function a(e,t){i.browser.permissions.remove({permissions:e.permissions},function(e){t(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.Remove=t.Get=void 0;var i=r(6);t.Get=n,t.Remove=a},207:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function i(e){}function o(e){1==e.read&&(new c.default).Render({content:"Hi, nice to use the ladder reader for the first time, do you have a look at the newbie help？",action:"yes",cancel:"no",callback:function(e){"action"==e&&f.browser.runtime.sendMessage(h.Add(h.MESSAGE_ACTION.new_tab,{url:"https://ladderreader.com"})),"cancel"==e&&f.browser.runtime.sendMessage(h.Add(h.MESSAGE_ACTION.tips_norepeat,{code:"readmode"}))}})}function s(e,t){var r=JSON.parse(localStorage["simpread-tips"]||"{}");t(!r[e])}function u(e){var t=JSON.parse(localStorage["simpread-tips"]||"{}");t[e]=!0,localStorage.setItem("simpread-tips",JSON.stringify(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.Help=t.Done=t.Verify=t.Render=void 0;var l=r(10),c=a(l),d=r(16),h=n(d),f=r(6);t.Render=i,t.Verify=s,t.Done=u,t.Help=o},472:function(e,t,r){"use strict";var n={GET:function(e,t){return this.request("GET",e,{},null,"text",t)},PROPFIND:function(e,t){return this.request("PROPFIND",e,{Depth:"1"},null,"xml",t)},MKCOL:function(e,t){return this.request("MKCOL",e,{},null,"text",t)},DELETE:function(e,t){return this.request("DELETE",e,{},null,"text",t)},PUT:function(e,t,r){return this.request("PUT",e,{},t,"text",r)},Author:function(e,t){this.user=e,this.password=t},request:function(e,t,r,n,a,i){var o=new XMLHttpRequest,s=function(){var e=o.responseText;if("xml"==a){var t=o.responseXML;t&&(e=t.firstChild.nextSibling?t.firstChild.nextSibling:t.firstChild)}return e};i&&(o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE&&"PROPFIND"==e){var t=s();t&&i(t)}else o.readyState===XMLHttpRequest.DONE&&i(o)}),o.open(e,t,!!i),o.setRequestHeader("Content-Type","text/xml; charset=UTF-8"),this.user&&this.password&&o.setRequestHeader("Authorization","Basic "+btoa(this.user+":"+this.password));for(var u in r)o.setRequestHeader(u,r[u]);if(o.send(n),!i)return s()}};n.Fs=function(e,t,r){n.Author(t,r),this.rootUrl=e;var a=this;return this.file=function(e){return this.type="file",this.url=a.urlFor(e),this.name=a.nameFor(this.url),this.read=function(e){return n.GET(this.url,e)},this.write=function(e,t){return n.PUT(this.url,e,t)},this.rm=function(e){return n.DELETE(this.url,e)},this},this.dir=function(e){return this.type="dir",this.url=a.urlFor(e),this.name=a.nameFor(this.url),this.children=function(e){var t=function(e){if(null==e.childNodes)throw"No such directory: "+url;for(var t=[],r=1;r<e.childNodes.length;r++){var n=e.childNodes[r],i=decodeURI(n.getElementsByTagName("d:href")[0].firstChild.nodeValue.replace(/\/$/,"")),o=n.getElementsByTagName("d:propstat")[0],s=o.getElementsByTagName("d:prop")[0],u=s.getElementsByTagName("d:resourcetype")[0],l=u.getElementsByTagName("d:collection")[0];l?t[r-1]=new a.dir(i):t[r-1]=new a.file(i)}return t};return e?void n.PROPFIND(this.url,function(r){e(t(r))}):t(n.PROPFIND(this.url))},this.rm=function(e){return n.DELETE(this.url,e)},this.mkdir=function(e){return n.MKCOL(this.url,e)},this},this.urlFor=function(e){return/^http/.test(e)?e:this.rootUrl+e},this.nameFor=function(e){return e.replace(/.*\/(.*)/,"$1")},this},e.exports=n}});